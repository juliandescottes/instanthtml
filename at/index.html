<!DOCTYPE html>
<html lang="en">
<head>
<title>Real Time HTML Editor</title>
<style type="text/css" media="screen">
    #editor { 
        position: absolute;
        top: 0;
        right: 50%;
        bottom: 50%;
        left: 0;
    }

    #model { 
        position: absolute;
        top: 50%;
        right: 50%;
        bottom: 0;
        left: 0;
    }

    #preview {
        position: absolute;
        top: 0;
        left: 50%;
        width : 50%;
        height:100%;
        border:none;
    }
</style>
</head>
<body>
    <div id="editor">{macro main()}
    {foreach fruit in data.fruits}
        ${fruit}, 
    {/foreach}
{/macro}</div>
    <div id="model">var data = {
    fruits : ["Banana", "Orange", "Apple"]
}</div>
    <div id="preview"></div>
    <script src="http://d1n0x3qji82z53.cloudfront.net/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="aria/ariatemplates-1.3.3.js" type="text/javascript"></script><script src="aria/css/atskin-1.3.3.js" type="text/javascript"></script>
    <script>
        var frame = document.getElementById("preview");
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/idle_fingers");
        editor.setFontSize("14px");
        editor.getSession().setMode("ace/mode/html");

        var model_editor = ace.edit("model");
        model_editor.setTheme("ace/theme/idle_fingers");
        model_editor.setFontSize("14px");
        model_editor.getSession().setMode("ace/mode/javascript");

        var loadTemplateInPreview = function (classDef, data) {
            Aria["eval"](classDef); 
            Aria.loadTemplate({
                classpath: "Test",
                div: "preview",
                data: data
            });
        };

        var loadTemplateFromString = function (tpl_content, data) {
            aria.core.ClassMgr.unloadClass("Test");
            var tplString = "{Template {$classpath : 'Test'}}"+tpl_content+"{/Template}"
            aria.templates.TplClassGenerator.parseTemplate(tplString, false,
                {
                    fn : function (res, args) {
                        if (res.classDef) {
                            loadTemplateInPreview(res.classDef, data)
                        } else {
                            console.log("Your template is not compiling")
                        }
                        
                    }
                },{"file_classpath" : "Test"}
            );
        };

        var onchange = function(){
            eval(model_editor.getValue());
            loadTemplateFromString(editor.getValue(),data);
        };

        editor.on("change", onchange);
        model_editor.on("change", onchange);

        // loading fake template to get necessary dependencies
        Aria.loadTemplate({classpath: "A",div: "preview",data:{}}, {fn : onchange, scope : null});

    </script>
</body>
</html>